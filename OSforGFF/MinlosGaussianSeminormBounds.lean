import Mathlib.Analysis.LocallyConvex.WithSeminorms
import Mathlib.Analysis.InnerProductSpace.Basic
import Mathlib.Data.Real.Sqrt

/-!
# Seminorm bounds from continuity (Gaussian setup)

If the (squared) covariance seminorm `f â†¦ â€–T fâ€–Â²` is continuous and the topology on `E` is
generated by a family of seminorms `p`, then `f â†¦ â€–T fâ€–` is bounded by a finite supremum of
seminorms from the family.

First step in relating the covariance to a *countable* generating family coming
from nuclearity hypotheses.
-/

open scoped BigOperators ENNReal NNReal

namespace OSforGFF

noncomputable section

namespace MinlosGaussianSeminormBounds

variable {E : Type*} [AddCommGroup E] [Module â„ E] [TopologicalSpace E]
variable {H : Type*} [NormedAddCommGroup H] [InnerProductSpace â„ H]

/-- If `f â†¦ â€–T fâ€–Â²` is continuous, then `f â†¦ â€–T fâ€–` is continuous. -/
theorem continuous_norm_of_continuous_norm_sq (T : E â†’â‚—[â„] H)
    (h_sq : Continuous fun f : E => (â€–T fâ€– ^ 2 : â„)) :
    Continuous fun f : E => â€–T fâ€– := by
  have h_sqrt : Continuous fun f : E => Real.sqrt (â€–T fâ€– ^ 2 : â„) :=
    (Real.continuous_sqrt.comp h_sq)
  simpa [Real.sqrt_sq_eq_abs, abs_of_nonneg (norm_nonneg _)] using h_sqrt

/-- If the topology on `E` is generated by a family of seminorms `p` and `â€–T Â·â€–` is continuous,
then it is controlled by finitely many seminorms from the family. -/
theorem seminorm_norm_comp_le_finset_sup
    {Î¹ : Type*} (p : Î¹ â†’ Seminorm â„ E) (hp : WithSeminorms p)
    (T : E â†’â‚—[â„] H)
    (h_sq : Continuous fun f : E => (â€–T fâ€– ^ 2 : â„)) :
    âˆƒ s : Finset Î¹, âˆƒ C : â„â‰¥0, C â‰  0 âˆ§ (normSeminorm â„ H).comp T â‰¤ C â€¢ s.sup p := by
  have hq : Continuous ((normSeminorm â„ H).comp T) := by
    have : Continuous fun f : E => ((normSeminorm â„ H).comp T) f := by
      simpa using (continuous_norm_of_continuous_norm_sq (E := E) (H := H) T h_sq)
    simpa using this
  exact Seminorm.bound_of_continuous (ğ•œ := â„) (p := p) (hp := hp) ((normSeminorm â„ H).comp T) hq

end MinlosGaussianSeminormBounds

end

end OSforGFF
